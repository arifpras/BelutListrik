ungroup() %>%
filter(position == pos)
#all players
fwd_pool <- fwd_maxpoints %>%
bind_rows(fwd_minprice) %>%
unique()
db06a <- t(combn(fwd_pool$Understat_Name, 3)) #max: 3 players
#saveRDS(db06a, "db06a.rds")
db06b <- db06a %>%
na.omit() %>%
as_tibble() %>%
mutate("id_fwd" = row_number()) %>%
relocate(id_fwd) %>%
pivot_longer(cols = 2:4,
names_to = "v",
values_to = "Understat_Name") %>%
select(-v) %>%
left_join(db01c, by = "Understat_Name") %>%
left_join(db00r, by = "team")
#saveRDS(db06b, "db06b.rds")
#db06c <- db06b %>%
#  group_by(id_fwd) %>%
#  mutate(
#    agg_avgpoints = sum(avg_points),
#    avg_wvgpoints = mean(wvg_points),
#    avg_avgminutes = mean(avg_minutes),
#    avg_stdpoints = mean(std_points),
#    agg_avgprice = sum(avg_price),
#    avg_stdinfluence = mean(std_influence),
#    avg_avgXG = mean(avg_xG),
#    avg_avgxA = mean(avg_xA),
#    avg_avgnpxG = mean(avg_npxG),
#    avg_avgxGChain = mean(avg_xGChain),
#    avg_avgxGBuildup = mean(avg_xGBuildup)
#  ) %>%
#  arrange(
#    desc(agg_avgpoints),
#    desc(avg_wvgpoints), #semakin besar, semakin worth it
#    agg_avgprice,
#    desc(avg_avgXG),
#    desc(avg_avgxA),
#    desc(avg_avgminutes),
#    desc(avg_stdpoints)
#  )
db06c <- db06b %>%
group_by(id_fwd) %>%
summarise(
agg_avgpoints = sum(avg_points),
avg_wvgpoints = mean(wvg_points),
avg_avgminutes = mean(avg_minutes),
avg_stdpoints = mean(std_points),
agg_avgprice = sum(avg_price),
avg_wvgprice = mean(wvg_price),
avg_stdinfluence = mean(std_influence),
avg_avgXG = mean(avg_xG),
avg_avgxA = mean(avg_xA),
avg_avgnpxG = mean(avg_npxG),
avg_avgxGChain = mean(avg_xGChain),
avg_avgxGBuildup = mean(avg_xGBuildup),
avg_avgsaves = mean(avg_saves),
avg_avgthreat = mean(avg_threat),
avg_difficulty = mean(difficulty_next5),
avg_avgclean = mean(avg_clean)
) %>%
arrange(
desc(agg_avgpoints),
desc(avg_wvgpoints), #semakin besar, semakin worth it
agg_avgprice,
desc(avg_avgXG),
desc(avg_avgxA),
desc(avg_avgminutes),
desc(avg_stdpoints)
)
#saveRDS(db06c, "db06c.rds")
#db99f <- db06c %>%
#  filter(between(total_avgpoints,
#                 quantile(total_avgpoints, .25),
#                 quantile(total_avgpoints, .75))
#         )
db06d <- db06c %>%
arrange(desc(agg_avgpoints)) %>%
filter(agg_avgprice < 20 & agg_avgprice > 19) %>%
slice_head(n = 5) %>%
left_join(db06b, by = "id_fwd") %>%
select(
id_def,
Understat_Name,
team,
avg_points,
std_points,
wvg_points,
avg_price,
wvg_price,
avg_xG,
avg_xA,
avg_xGChain,
avg_xGBuildup,
avg_saves,
avg_threat,
avg_clean,
difficulty_next5,
agg_avgprice,
agg_avgpoints,
avg_stdpoints,
avg_wvgpoints,
avg_wvgprice,
avg_avgXG,
avg_avgxA,
avg_avgxGChain,
avg_avgxGBuildup,
avg_avgsaves,
avg_avgthreat,
avg_difficulty,
avg_avgclean
) %>%
arrange(desc(agg_avgpoints),
desc(avg_wvgpoints)) %>%
relocate(id_fwd,
Understat_Name,
team,
avg_points,
avg_price,
avg_threat,
avg_difficulty)
db06d <- db06c %>%
arrange(desc(agg_avgpoints)) %>%
filter(agg_avgprice < 20 & agg_avgprice > 19) %>%
slice_head(n = 5) %>%
left_join(db06b, by = "id_fwd") %>%
select(
id_fwd,
Understat_Name,
team,
avg_points,
std_points,
wvg_points,
avg_price,
wvg_price,
avg_xG,
avg_xA,
avg_xGChain,
avg_xGBuildup,
avg_saves,
avg_threat,
avg_clean,
difficulty_next5,
agg_avgprice,
agg_avgpoints,
avg_stdpoints,
avg_wvgpoints,
avg_wvgprice,
avg_avgXG,
avg_avgxA,
avg_avgxGChain,
avg_avgxGBuildup,
avg_avgsaves,
avg_avgthreat,
avg_difficulty,
avg_avgclean
) %>%
arrange(desc(agg_avgpoints),
desc(avg_wvgpoints)) %>%
relocate(id_fwd,
Understat_Name,
team,
avg_points,
avg_price,
avg_threat,
avg_difficulty)
(
fwd_plot <- db06d %>%
select(
id_fwd,
agg_avgprice,
agg_avgpoints,
avg_avgXG,
avg_avgxA,
avg_threat,
avg_difficulty
) %>%
group_by(id_fwd) %>%
slice_head(n=1) %>%
ungroup() %>%
pivot_longer(
cols = 2:7,
names_to = "indicator",
values_to = "value"
) %>%
ggplot(aes(
x = reorder_within(id_fwd, value, indicator),
y = value,
fill = factor(id_fwd)
)) +
geom_col() +
#geom_bar(stat = "identity", aes(fill = factor(id_gk))) +
coord_flip() +
scale_x_reordered() +
#scale_fill_viridis(discrete = TRUE) +
#scale_fill_manual(values = wes_palette("Darjeeling1")) +
scale_fill_manual(values = c("#ef476f","#ffd166","#06d6a0","#118ab2","#073b4c")) +
egg::theme_article() +
facet_wrap(~ indicator, ncol = 3, scales = "free") +
theme(
legend.position = "none"
) +
labs(
x = "",
y = ""
)
)
(fwd_choice <- db06d %>% filter(id_fwd == 586) %>% mutate("position" = "FWD"))
(fwd_choice <- db06d %>% filter(id_fwd == 573) %>% mutate("position" = "FWD"))
(fwd_choice <- db06d %>% filter(id_fwd == 587) %>% mutate("position" = "FWD"))
(fwd_choice <- db06d %>% filter(id_fwd == 586) %>% mutate("position" = "FWD"))
(fwd_choice <- db06d %>% filter(id_fwd == 573) %>% mutate("position" = "FWD"))
(belutlistrik_squad <- (gk_choice %>% rename("id" = id_gk)) %>%
bind_rows((def_choice %>% rename("id" = id_def)),
(mid_choice %>% rename("id" = id_mid)),
(fwd_choice %>% rename("id" = id_fwd))
) %>%
mutate(
"formid" = row_number()
) %>%
relocate(id, formid, Understat_Name, position) %>%
mutate(
Understat_Name = recode(Understat_Name, "Trent Alexander-Arnold" = "Trent")
)
)
(belutlistrik_squad <- (gk_choice %>% rename("id" = id_gk)) %>%
bind_rows((def_choice %>% rename("id" = id_def)),
(mid_choice %>% rename("id" = id_mid)),
(fwd_choice %>% rename("id" = id_fwd))
) %>%
mutate(
"formid" = row_number()
) %>%
relocate(id, formid, Understat_Name, position) %>%
mutate(
Understat_Name = recode(Understat_Name, "Trent Alexander-Arnold" = "Trent")
)
)
sum(belutlistrik_squad$agg_avgprice)
sum(belutlistrik_squad$avg_price)
(
belutlistrik_select <- belutlistrik_squad %>%
filter(position != "GK") %>%
select(
Understat_Name,
position,
avg_points,
avg_price,
#wvg_points,
avg_xG,
avg_xA,
avg_xGChain,
avg_xGBuildup,
std_points,
avg_threat,
avg_clean,
difficulty_next5
) %>%
pivot_longer(
cols = 3:13,
names_to = "indicator",
values_to = "value"
) %>%
#mutate(
#  "indicator" = as.factor(indicator),
#  "Understat_Name" = tidytext::reorder_within(Understat_Name, value, indicator)
#    ) %>%
ggplot(aes(
x = reorder_within(Understat_Name, value, indicator),
y = value,
fill = factor(position)
)) +
#geom_col(show.legend = FALSE) +
geom_col() +
#geom_bar(stat = "identity", aes(fill = factor(position))) +
coord_flip() +
scale_x_reordered() +
#scale_fill_viridis(discrete = TRUE) +
#scale_fill_manual(values = wes_palette("Darjeeling1")) +
scale_fill_manual(values = c("#ef476f", "#ffd166", "#06d6a0")) +
egg::theme_article() +
facet_wrap( ~ indicator, ncol = 5, scales = "free_y") +
theme(legend.position = "top",
legend.title = element_blank()) +
labs(x = "",
y = "")
#guides(fill = guide_legend("Position:"))
)
(
belutlistrik_select <- belutlistrik_squad %>%
filter(position != "GK") %>%
select(
Understat_Name,
position,
avg_points,
avg_price,
#wvg_points,
avg_xG,
avg_xA,
avg_xGChain,
avg_xGBuildup,
std_points,
avg_threat,
avg_clean,
difficulty_next5
) %>%
pivot_longer(
cols = 3:12,
names_to = "indicator",
values_to = "value"
) %>%
#mutate(
#  "indicator" = as.factor(indicator),
#  "Understat_Name" = tidytext::reorder_within(Understat_Name, value, indicator)
#    ) %>%
ggplot(aes(
x = reorder_within(Understat_Name, value, indicator),
y = value,
fill = factor(position)
)) +
#geom_col(show.legend = FALSE) +
geom_col() +
#geom_bar(stat = "identity", aes(fill = factor(position))) +
coord_flip() +
scale_x_reordered() +
#scale_fill_viridis(discrete = TRUE) +
#scale_fill_manual(values = wes_palette("Darjeeling1")) +
scale_fill_manual(values = c("#ef476f", "#ffd166", "#06d6a0")) +
egg::theme_article() +
facet_wrap( ~ indicator, ncol = 5, scales = "free_y") +
theme(legend.position = "top",
legend.title = element_blank()) +
labs(x = "",
y = "")
#guides(fill = guide_legend("Position:"))
)
belutlistrik_select
(
belutlistrik_select <- belutlistrik_squad %>%
filter(position != "GK") %>%
select(
Understat_Name,
position,
avg_points,
avg_price,
#wvg_points,
avg_xG,
avg_xA,
avg_xGChain,
avg_xGBuildup,
#std_points,
avg_threat,
#avg_clean,
difficulty_next5
) %>%
pivot_longer(
cols = 3:10,
names_to = "indicator",
values_to = "value"
) %>%
#mutate(
#  "indicator" = as.factor(indicator),
#  "Understat_Name" = tidytext::reorder_within(Understat_Name, value, indicator)
#    ) %>%
ggplot(aes(
x = reorder_within(Understat_Name, value, indicator),
y = value,
fill = factor(position)
)) +
#geom_col(show.legend = FALSE) +
geom_col() +
#geom_bar(stat = "identity", aes(fill = factor(position))) +
coord_flip() +
scale_x_reordered() +
#scale_fill_viridis(discrete = TRUE) +
#scale_fill_manual(values = wes_palette("Darjeeling1")) +
scale_fill_manual(values = c("#ef476f", "#ffd166", "#06d6a0")) +
egg::theme_article() +
facet_wrap( ~ indicator, ncol = 5, scales = "free_y") +
theme(legend.position = "top",
legend.title = element_blank()) +
labs(x = "",
y = "")
#guides(fill = guide_legend("Position:"))
)
belutlistrik_select
(
belutlistrik_select <- belutlistrik_squad %>%
filter(position != "GK") %>%
select(
Understat_Name,
position,
avg_points,
avg_price,
#wvg_points,
avg_xG,
avg_xA,
avg_xGChain,
avg_xGBuildup,
#std_points,
avg_threat,
#avg_clean,
difficulty_next5
) %>%
pivot_longer(
cols = 3:10,
names_to = "indicator",
values_to = "value"
) %>%
#mutate(
#  "indicator" = as.factor(indicator),
#  "Understat_Name" = tidytext::reorder_within(Understat_Name, value, indicator)
#    ) %>%
ggplot(aes(
x = reorder_within(Understat_Name, value, indicator),
y = value,
fill = factor(position)
)) +
#geom_col(show.legend = FALSE) +
geom_col() +
#geom_bar(stat = "identity", aes(fill = factor(position))) +
coord_flip() +
scale_x_reordered() +
#scale_fill_viridis(discrete = TRUE) +
#scale_fill_manual(values = wes_palette("Darjeeling1")) +
scale_fill_manual(values = c("#ef476f", "#ffd166", "#06d6a0")) +
egg::theme_article() +
facet_wrap( ~ indicator, ncol = 4, scales = "free_y") +
theme(legend.position = "top",
legend.title = element_blank()) +
labs(x = "",
y = "")
#guides(fill = guide_legend("Position:"))
)
belutlistrik_select
(belutlistrik_options <- belutlistrik_squad %>%
mutate(
"form352" = ifelse(formid %in% c(2, 6, 7, 15), "bench", "play"),
"form442" = ifelse(formid %in% c(2, 7, 12, 15), "bench", "play"),
"form343" = ifelse(formid %in% c(2, 6, 7, 12), "bench", "play")
) %>%
relocate(id, formid, form442, form343, form352, Understat_Name)
)
(for352 <- tibble(
x = c(98, 98, 83, 83, 83, 89 ,80, 68, 68, 68, 68, 68, 53, 53, 71),
y = c(50, 110, 25, 50, 75, 110, 110, 10, 30, 50, 70, 90, 37.5, 62.5, 110),
formid = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)
))
(for442 <- tibble(
x = c(98, 98, 83, 83, 83, 83, 89 ,68, 68, 68, 68, 80, 53, 53, 71),
y = c(50, 110, 20, 40, 60, 80, 110, 20, 40, 60, 80, 110, 37.5, 62.5, 110),
formid = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)
))
(for343 <- tibble(
x = c(98, 98, 83, 83, 83, 89, 80, 68, 68, 68, 68, 71, 53, 53, 53),
y = c(50, 110, 25, 50, 75, 110, 110, 20, 40, 60, 80, 110, 25, 50, 75),
formid = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15)
))
(
belutlistrik_442 <- belutlistrik_options %>%
select(formid, form442, Understat_Name) %>%
right_join(for442, by = "formid")
)
(
belutlistrik_343 <- belutlistrik_options %>%
select(formid, form343, Understat_Name) %>%
right_join(for343, by = "formid")
)
(
belutlistrik <- ggplot(belutlistrik_442) + #change
annotate_pitch(
colour = "white",
fill   = "#e0e2db",
limits = FALSE
) +
geom_point(
aes(x = x, y = 100 - y, fill = factor(form442)), #change
shape = 21,
size = 5
) +
scale_fill_manual(values = c("play" = "#8b2635", "bench" = "#2e3532")) +
geom_text_repel(
aes(
x = x,
y = 100 - y,
label = stringr::str_wrap(Understat_Name, 10),
color = factor(form442) #change
),
direction = "y",
nudge_x = -4,
segment.colour = NA,
size = 3,
#box.padding = unit(-2.5, "lines")
) +
scale_color_manual(values = c("play" = "#8b2635", "bench" = "#2e3532")) +
theme_pitch() +
theme(
panel.background = element_rect(fill = "#e0e2db"),
legend.position = "none",
plot.title = element_text(hjust = 0, size = 18,
face = "bold"),
plot.subtitle = element_text(hjust = 0, size = 14),
) +
coord_flip(xlim = c(49, 101),
ylim = c(-12, 112)) +
ggtitle("Belut Listrik FC",
"instagram/arifpras")
)
#belutlistrik
